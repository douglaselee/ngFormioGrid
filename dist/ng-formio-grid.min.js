!function r(a,s,l){function d(i,e){if(!s[i]){if(!a[i]){var n="function"==typeof require&&require;if(!e&&n)return n(i,!0);if(c)return c(i,!0);var t=new Error("Cannot find module '"+i+"'");throw t.code="MODULE_NOT_FOUND",t}var o=s[i]={exports:{}};a[i][0].call(o.exports,function(e){return d(a[i][1][e]||e)},o,o.exports,r,a,s,l)}return s[i].exports}for(var c="function"==typeof require&&require,e=0;e<l.length;e++)d(l[e]);return d}({1:[function(e,i,n){"use strict";angular.module("ngFormioGrid",["formio","ngSanitize","ui.grid","ui.grid.pagination","ui.grid.resizeColumns","ui.grid.autoResize","ui.grid.selection","ui.grid.edit","ui.grid.cellNav"]).directive("formioGridCell",["$compile","formioTableView",function(e,o){return{restrict:"E",scope:{data:"=",component:"="},link:function(n,t){n.$watch("data",function(e){var i=o(e,n.component);Array.isArray(i)&&(i=i.join(", ")),t.html(i)})}}}]).directive("formioGrid",["$compile",function(o){return{restrict:"E",replace:!0,scope:{src:"=",service:"=?",query:"=?",aggregate:"=?",columns:"=?",buttons:"=?",gridOptions:"=?",gridApi:"=?",limit:"=?"},link:function(e,i,n){var t='<div ui-grid="gridOptionsDef" ui-grid-pagination ui-grid-auto-resize ui-grid-resize-columns ui-grid-move-columns ui-grid-selection class="grid"></div>';e.gridOptions&&e.gridOptions.enableCellEdit&&(t='<div ui-grid="gridOptionsDef" ui-grid-pagination ui-grid-auto-resize ui-grid-resize-columns ui-grid-move-columns ui-grid-edit ui-grid-cellNav class="grid"></div>'),i.html(t).show(),o(i.contents())(e)},template:"<div></div>",controller:["$scope","$element","$timeout","Formio","formioComponents","FormioUtils","uiGridConstants","$http","$q",function(u,n,i,s,e,r,t,l,o){var a=o.defer(),d=a.promise,c=u.service||null,g={pageNumber:1,pageSize:25,sort:null};u.query&&u.query.sort&&(g.sort=u.query.sort);var p={},f=function(){p=u.columns,Array.isArray(u.columns)&&(p={},u.columns.forEach(function(e){"string"==typeof e?p[e]={}:p[e.key]=e}))};f();var m=function(e,i){switch(e.direction){case t.ASC:g.sort=i;break;case t.DESC:g.sort="-"+i;break;case void 0:g.sort=null}},h=function(e){var i=angular.element(".ui-grid-contents-wrapper .ui-grid-loader",n);if(e&&0==i.length){angular.element(".ui-grid-contents-wrapper",n).prepend('<i style="font-size:2em;position:absolute;z-index:200;left: 50%;top:50%;margin-left:-1em;margin-top:-1em;" class="ui-grid-loader glyphicon glyphicon-refresh glyphicon-spin"></i>')}else i.length&&i.remove()};u.gridOptionsDef=angular.extend({namespace:"row",dataRoot:"data.",responseData:"",responseTotal:"",endpoint:"",paginationPageSizes:[25,50,75],paginationPageSize:g.pageSize,enableHorizontalScrollbar:t.scrollbars.NEVER,enableVerticalScrollbar:t.scrollbars.NEVER,useExternalPagination:!0,useExternalSorting:!0,enableCellEdit:!1,enableCellEditOnFocus:!1,enableRowSelection:!0,enableRowHeaderSelection:!1,enableFiltering:!0,useExternalFiltering:!0,multiSelect:!1,loadOptions:null,columnDefs:[],data:[],initialLoad:!0,onRegisterApi:function(t){(u.gridApi=t).pagination.on.paginationChanged(u,function(e,i){g.pageNumber=e,g.pageSize=i,O()}),t.core.on.renderingComplete(u,function(){h(!0),u.gridOptions.sort&&m(u.gridOptions.sort,u.gridOptions.sort.defaultCol)});var i=0;t.core.on.filterChanged(u,function(){var e=this.grid;i&&clearTimeout(i),i=setTimeout(function(){e.columns.forEach(function(e){var i="";e.filters&&0<e.filters.length&&(i=e.filters[0].term);var n=e.colDef.filterField||e.colDef.filter||e.colDef.field;n&&("function"==typeof n?n(u.query,i):"object"==typeof n?"select"===n.type&&("boolean"==typeof i?u.query[e.colDef.field]=i:i?u.query[e.colDef.field]=i:delete u.query[e.colDef.field]):i?u.query[n+"__regex"]="/"+r.escapeRegExCharacters(i)+"/i":delete u.query[n+"__regex"])}),t.pagination.seek(1),O()},500)});t.core.on.rowsRendered(u,function(){0!==t.grid.renderContainers.body.visibleRowCache.length&&(u.$emit("onGridLoadDone"),!1)}),t.selection&&(t.selection.on.rowSelectionChanged(u,function(e){u.$emit(u.gridOptionsDef.namespace+"Select",e.entity,e.isSelected)}),t.selection.on.rowSelectionChangedBatch(u,function(e){var i=!!e.length&&e[0].isSelected;u.$emit(u.gridOptionsDef.namespace+"SelectAll",e,i)})),t.edit&&t.edit.on.afterCellEdit(u,function(e,i,n,t){u.$emit(u.gridOptionsDef.namespace+"CellEdit",e,i,n,t),u.$apply()}),t.core.on.sortChanged(u,function(e,i){if(0===i.length)g.sort=null;else{var n=i.length-1;m(i[n].sort,i[n].colDef.sortField||i[n].colDef.field)}t.pagination.seek(1),O()})}},u.gridOptions),g.pageSize=u.gridOptionsDef.paginationPageSize,u.buttons=u.buttons||[],u.buttonClick=function(e,i){u.$emit(e,i.entity,i)},angular.isUndefined(u.query)&&(u.query={});var O=function(a){d.then(function(){if(u.gridOptions&&u.gridOptions.columnDefs&&(u.gridOptionsDef.columnDefs=u.gridOptions.columnDefs),g.pageSize&&(u.limit?u.query.limit=u.limit:u.query.limit=g.pageSize),g.pageNumber&&(u.query.skip=(g.pageNumber-1)*g.pageSize),u.query.sort=g.sort,u.gridOptionsDef.endpoint){var e=u.gridOptionsDef.endpoint,i={headers:{"x-jwt-token":s.getToken()}};if(u.aggregate){var n=a||angular.copy(u.aggregate),t={};if(angular.forEach(u.query,function(e,i){if(0===i.indexOf("data."))if(-1!==i.indexOf("__regex")){var n=e.match(/\/([^\/]+)\//);(n=n&&1<n.length?n[1]:"")&&(t[i.replace("__regex","")]={$regex:n,$options:"i"})}else t[i]=e}),0<Object.keys(t).length&&n.push({$match:t}),u.query.sort){var o={$sort:{}};if("-"===u.query.sort.charAt(0)){var r=u.query.sort.slice(1);o.$sort[r]=-1,n.push(o)}else o.$sort[u.query.sort]=1,n.push(o)}u.query.limit&&n.push({$limit:u.query.limit}),u.query.skip&&n.push({$skip:u.query.skip}),i.headers["x-query"]=JSON.stringify(n)}else i.params=a||u.query;u.$emit("onRequest",n||i.params),u.$emit("onRequest:"+u.gridOptionsDef.namespace,n||i.params),l.get(e,i).then(function(e){e.data||(e.data=[]);var i=e.headers("Content-Range");i&&1<(i=i.split("/")).length&&"*"!=i[1]&&(u.gridOptionsDef.totalItems=Number(i[1])),u.gridOptionsDef.responseData?u.gridOptionsDef.data=e.data[u.gridOptionsDef.responseData]:u.gridOptionsDef.data=e.data?e.data:[],u.gridOptionsDef.responseTotal&&(u.gridOptionsDef.totalItems=e.data[u.gridOptionsDef.responseTotal]),y(e.data.length),h(!1),u.$emit("onData",e.data),u.$emit("onData:"+u.gridOptionsDef.namespace,e.data)},function(e){console.log("Error: "+e.message)})}else{if(!c)return void h(!1);u.gridOptionsDef.data=[],u.$emit("onRequest",u.query),u.$emit("onRequest:"+u.gridOptionsDef.namespace,u.query),c.loadSubmissions({params:u.query},u.gridOptionsDef.loadOptions).then(function(e){u.gridOptionsDef.totalItems=e.serverCount,u.gridOptionsDef.data=e,y(e.length),h(!1),u.$emit("onData",e),u.$emit("onData:"+u.gridOptionsDef.namespace,e)})}})},y=function(e){return i(function(){var e=u.gridOptions&&u.gridOptions.height?u.gridOptions.height:30*u.gridApi.grid.getVisibleRowCount()+100;angular.element(".grid",n).height(e)},10),e},D=function(s){f();var l={},d=1;u.gridOptionsDef.columnDefs=u.gridOptions&&u.gridOptions.columnDefs?angular.copy(u.gridOptions.columnDefs):[],u.buttons.forEach(function(e){var i=e.class||"btn btn-sm btn-default";l[e.label]=!0,u.gridOptionsDef.columnDefs.unshift({name:e.label,field:e.key,width:e.width,enableFiltering:!1,cellTemplate:'<a class="'+i+'" ng-click="grid.appScope.buttonClick(\''+e.event+'\', row)"><span class="'+e.icon+'" aria-hidden="true"></span>'+e.label+"</a>"})});var c=0,t=function(e,i,n){i=i||{},0!==c||i.hasOwnProperty("link")||(i.link=!0);var t="";if(i.hasOwnProperty("label"))t=i.label;else if(e)for(t=e.label||e.key;l.hasOwnProperty(t);)t=e.label+d++;l[t]=!0;var o=i.template||'<formio-grid-cell class="ui-grid-cell-contents" data="COL_FIELD" component="col.colDef.component"></formio-grid-cell>';i.link&&(o='<a class="'+i.linkClass+'" style="cursor:pointer;" ng-click="grid.appScope.buttonClick(\''+(i.linkEvent||u.gridOptionsDef.namespace+"View")+"', row)\">"+o+"</a>");var r=i.field;i.field||(r=e?u.gridOptionsDef.dataRoot+e.key:n);var a={component:e,name:t,field:r,cellTemplate:o,form:s,enableCellEdit:!!i.enableCellEdit,enableFiltering:!!i.enableFiltering};["sort","sortField","filterField","filter","width","sortable","visible","minWidth","maxWidth","resizable","cellClass","headerCellClass","headerCellTemplate"].forEach(function(e){i.hasOwnProperty(e)&&(a[e]=i[e])}),u.gridOptionsDef.columnDefs.push(a),c++};if(p&&0<Object.keys(p).length){var o=s?r.flattenComponents(s.components):{};angular.forEach(p,function(e,i){if(e.sort&&e.sort.direction){var n=o.hasOwnProperty(i)?"data."+i:i;m(e.sort,e.field||n)}t(o[i]||e.component,e,i)})}else s&&r.eachComponent(s.components,function(e){e.input&&e.tableView&&e.key&&t(e)});a.resolve(),u.gridOptionsDef.initialLoad&&O(),u.gridOptionsDef.initialLoad=!0,u.$emit("onGridReady"),u.$emit("onGridReady:"+u.gridOptionsDef.namespace)},b=function(){u.src?(c=new s(u.src)).loadForm().then(D):D()},v=function(i){u.gridOptionsDef.enableRowSelection&&("string"==typeof i?angular.forEach(u.gridOptionsDef.data,function(e){e._id.toString()===i&&u.gridApi.selection.selectRow(e)}):u.gridApi.selection.selectRow(i))},q=function(e){h(!0),e&&(u.query=e),O(e)},$=function(e,i){e&&(u.src=e),i&&(u.query=i),h(!0),b()};u.$on("selectGridRow:"+u.gridOptionsDef.namespace,function(e,i){v(i)}),u.$on("selectGridRow",function(e,i){v(i)}),u.$on("reloadGrid:"+u.gridOptionsDef.namespace,function(e,i,n){$(i,n)}),u.$on("reloadGrid",function(e,i,n){$(i,n)}),u.$on("refreshGrid:"+u.gridOptionsDef.namespace,function(e,i){q(i)}),u.$on("setLoading",function(e,i){h(i)}),u.$on("refreshGrid",function(e,i){q(i)}),u.$on("adjustHeight",function(e,i){y(i)}),b()}]}}])},{}]},{},[1]);