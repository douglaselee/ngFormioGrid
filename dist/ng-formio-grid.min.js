!function e(i,n,t){function r(a,s){if(!n[a]){if(!i[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(o)return o(a,!0);var d=new Error("Cannot find module '"+a+"'");throw d.code="MODULE_NOT_FOUND",d}var c=n[a]={exports:{}};i[a][0].call(c.exports,function(e){var n=i[a][1][e];return r(n?n:e)},c,c.exports,e,i,n,t)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<t.length;a++)r(t[a]);return r}({1:[function(e,i,n){"use strict";angular.module("ngFormioGrid",["formio","ngSanitize","ui.grid","ui.grid.pagination","ui.grid.resizeColumns","ui.grid.autoResize","ui.grid.selection","ui.grid.edit","ui.grid.cellNav"]).directive("formioGridCell",["$compile","formioTableView",function(e,i){return{restrict:"E",scope:{data:"=",component:"="},link:function(e,n){e.$watch("data",function(t){var r=i(t,e.component);Array.isArray(r)&&(r=r.join(", ")),n.html(r)})}}}]).directive("formioGrid",["$compile",function(e){return{restrict:"E",replace:!0,scope:{src:"=",query:"=?",aggregate:"=?",columns:"=?",buttons:"=?",gridOptions:"=?",gridApi:"=?"},link:function(i,n,t){var r='<div ui-grid="gridOptionsDef" ui-grid-pagination ui-grid-auto-resize ui-grid-resize-columns ui-grid-move-columns ui-grid-selection class="grid"></div>';i.gridOptions&&i.gridOptions.enableCellEdit&&(r='<div ui-grid="gridOptionsDef" ui-grid-pagination ui-grid-auto-resize ui-grid-resize-columns ui-grid-move-columns ui-grid-edit ui-grid-cellNav class="grid"></div>'),n.html(r).show(),e(n.contents())(i)},template:"<div></div>",controller:["$scope","$element","$timeout","Formio","formioComponents","FormioUtils","uiGridConstants","$http","$q",function(e,i,n,t,r,o,a,s,l){var d=l.defer(),c=d.promise,u=null,g={pageNumber:1,pageSize:25,sort:null};e.query&&e.query.sort&&(g.sort=e.query.sort);var p={},f=function(){p=e.columns,Array.isArray(e.columns)&&(p={},e.columns.forEach(function(e){"string"==typeof e?p[e]={}:p[e.key]=e}))};f();var m=function(e,i){switch(e.direction){case a.ASC:g.sort=i;break;case a.DESC:g.sort="-"+i;break;case void 0:g.sort=null}},h=function(e){var n=angular.element(".ui-grid-contents-wrapper .ui-grid-loader",i);if(e&&0==n.length){var t='<i style="font-size:2em;position:absolute;z-index:200;left: 50%;top:50%;margin-left:-1em;margin-top:-1em;" class="ui-grid-loader glyphicon glyphicon-refresh glyphicon-spin"></i>';angular.element(".ui-grid-contents-wrapper",i).prepend(t)}else n.length&&n.remove()};e.gridOptionsDef=angular.merge({namespace:"row",dataRoot:"data.",responseData:"",responseTotal:"",endpoint:"",paginationPageSizes:[25,50,75],paginationPageSize:g.pageSize,enableHorizontalScrollbar:a.scrollbars.NEVER,enableVerticalScrollbar:a.scrollbars.NEVER,useExternalPagination:!0,useExternalSorting:!0,enableCellEdit:!1,enableCellEditOnFocus:!1,enableRowSelection:!0,enableRowHeaderSelection:!1,enableFiltering:!0,useExternalFiltering:!0,multiSelect:!1,loadOptions:null,columnDefs:[],data:[],initialLoad:!0,onRegisterApi:function(i){e.gridApi=i,i.pagination.on.paginationChanged(e,function(e,i){g.pageNumber=e,g.pageSize=i,y()}),i.core.on.renderingComplete(e,function(){h(!0)});var n=0;i.core.on.filterChanged(e,function(){var t=this.grid;n&&clearTimeout(n),n=setTimeout(function(){t.columns.forEach(function(i){var n="";i.filters&&i.filters.length>0&&(n=i.filters[0].term);var t=i.colDef.filterField||i.colDef.filter||i.colDef.field;t&&("function"==typeof t?t(e.query,n):"object"==typeof t?"select"===t.type&&("boolean"==typeof n?e.query[i.colDef.field]=n:n?e.query[i.colDef.field]=n:delete e.query[i.colDef.field]):n?e.query[t+"__regex"]="/"+o.escapeRegExCharacters(n)+"/i":delete e.query[t+"__regex"])}),i.pagination.seek(1),y()},500)});var t=!0;i.core.on.rowsRendered(e,function(){0!==i.grid.renderContainers.body.visibleRowCache.length&&(e.$emit("onGridLoadDone"),t=!1)}),i.selection&&(i.selection.on.rowSelectionChanged(e,function(i){e.$emit(e.gridOptionsDef.namespace+"Select",i.entity,i.isSelected)}),i.selection.on.rowSelectionChangedBatch(e,function(i){var n=!!i.length&&i[0].isSelected;e.$emit(e.gridOptionsDef.namespace+"SelectAll",i,n)})),i.edit&&i.edit.on.afterCellEdit(e,function(i,n,t,r){e.$emit(e.gridOptionsDef.namespace+"CellEdit",i,n,t,r),e.$apply()}),i.core.on.sortChanged(e,function(e,n){if(0===n.length)g.sort=null;else{var t=n.length-1;m(n[t].sort,n[t].colDef.field)}i.pagination.seek(1),y()})}},e.gridOptions),g.pageSize=e.gridOptionsDef.paginationPageSize,e.buttons=e.buttons||[],e.buttonClick=function(i,n){e.$emit(i,n.entity,n)},angular.isUndefined(e.query)&&(e.query={});var y=function(i){c.then(function(){if(e.gridOptions&&e.gridOptions.columnDefs&&(e.gridOptionsDef.columnDefs=e.gridOptions.columnDefs),g.pageSize&&(e.query.limit=g.pageSize),g.pageNumber&&(e.query.skip=(g.pageNumber-1)*g.pageSize),e.query.sort=g.sort,e.gridOptionsDef.endpoint){var n=e.gridOptionsDef.endpoint,r={headers:{"x-jwt-token":t.getToken()}};if(e.aggregate){var o=i?i:angular.copy(e.aggregate),a={};if(angular.forEach(e.query,function(e,i){if(0===i.indexOf("data."))if(i.indexOf("__regex")!==-1){var n=e.match(/\/([^\/]+)\//);n=n&&n.length>1?n[1]:"",n&&(a[i.replace("__regex","")]={$regex:n,$options:"i"})}else a[i]=e}),Object.keys(a).length>0&&o.push({$match:a}),e.query.sort){var l={$sort:{}};if("-"===e.query.sort.charAt(0)){var d=e.query.sort.slice(1);l.$sort[d]=-1,o.push(l)}else l.$sort[e.query.sort]=1,o.push(l)}e.query.limit&&o.push({$limit:e.query.limit}),e.query.skip&&o.push({$skip:e.query.skip}),r.headers["x-query"]=JSON.stringify(o)}else r.params=i?i:e.query;e.$emit("onRequest",o||r.params),e.$emit("onRequest:"+e.gridOptionsDef.namespace,o||r.params),s.get(n,r).then(function(i){i.data||(i.data=[]);var n=i.headers("Content-Range");n&&(n=n.split("/"),n.length>1&&"*"!=n[1]&&(e.gridOptionsDef.totalItems=Number(n[1]))),e.gridOptionsDef.responseData?e.gridOptionsDef.data=i.data[e.gridOptionsDef.responseData]:e.gridOptionsDef.data=i.data?i.data:[],e.gridOptionsDef.responseTotal&&(e.gridOptionsDef.totalItems=i.data[e.gridOptionsDef.responseTotal]),O(i.data.length),h(!1),e.$emit("onData",i.data),e.$emit("onData:"+e.gridOptionsDef.namespace,i.data)},function(e){console.log("Error: "+e.message)})}else{if(!u)return;e.gridOptionsDef.data=[],e.$emit("onRequest",e.query),e.$emit("onRequest:"+e.gridOptionsDef.namespace,e.query),u.loadSubmissions({params:e.query},e.gridOptionsDef.loadOptions).then(function(i){e.gridOptionsDef.totalItems=i.serverCount,e.gridOptionsDef.data=i,O(i.length),h(!1),e.$emit("onData",i),e.$emit("onData:"+e.gridOptionsDef.namespace,i)})}})},O=function(t){return n(function(){var n=e.gridOptions&&e.gridOptions.height?e.gridOptions.height:30*e.gridApi.grid.getVisibleRowCount()+100;angular.element(".grid",i).height(n)},10),t},D=function(i){f();var n={},t=1;e.gridOptionsDef.columnDefs=e.gridOptions&&e.gridOptions.columnDefs?angular.copy(e.gridOptions.columnDefs):[],e.buttons.forEach(function(i){var t=i["class"]||"btn btn-sm btn-default";n[i.label]=!0,e.gridOptionsDef.columnDefs.unshift({name:i.label,field:i.key,width:i.width,enableFiltering:!1,cellTemplate:'<a class="'+t+'" ng-click="grid.appScope.buttonClick(\''+i.event+'\', row)"><span class="'+i.icon+'" aria-hidden="true"></span>'+i.label+"</a>"})});var r=0,a=function(o,a,s){a=a||{},0!==r||a.hasOwnProperty("link")||(a.link=!0);var l="";if(a.hasOwnProperty("label"))l=a.label;else if(o)for(l=o.label||o.key;n.hasOwnProperty(l);)l=o.label+t++;n[l]=!0;var d=a.template||'<formio-grid-cell class="ui-grid-cell-contents" data="COL_FIELD" component="col.colDef.component"></formio-grid-cell>';if(a.link){var c=a.linkClass,u=a.linkEvent||e.gridOptionsDef.namespace+"View";d='<a class="'+c+'" style="cursor:pointer;" ng-click="grid.appScope.buttonClick(\''+u+"', row)\">"+d+"</a>"}var g=a.field;a.field||(g=o?e.gridOptionsDef.dataRoot+o.key:s);var p={component:o,name:l,field:g,cellTemplate:d,form:i,enableCellEdit:!!a.enableCellEdit,enableFiltering:!!a.enableFiltering};["sort","filterField","filter","width","sortable","visible","minWidth","maxWidth","resizable","cellClass","headerCellClass","headerCellTemplate"].forEach(function(e){a.hasOwnProperty(e)&&(p[e]=a[e])}),e.gridOptionsDef.columnDefs.push(p),r++};if(p&&Object.keys(p).length>0){var s=i?o.flattenComponents(i.components):{};angular.forEach(p,function(e,i){if(e.sort&&e.sort.direction){var n=s.hasOwnProperty(i)?"data."+i:i;m(e.sort,e.field||n)}a(s[i],e,i)})}else i&&o.eachComponent(i.components,function(e){e.input&&e.tableView&&e.key&&a(e)});d.resolve(),e.gridOptionsDef.initialLoad&&y(),e.gridOptionsDef.initialLoad=!0,e.$emit("onGridReady"),e.$emit("onGridReady:"+e.gridOptionsDef.namespace)},v=function(){return e.src?(u=new t(e.src),void u.loadForm().then(D)):void D()},b=function(i){e.gridOptionsDef.enableRowSelection&&("string"==typeof i?angular.forEach(e.gridOptionsDef.data,function(n){n._id.toString()===i&&e.gridApi.selection.selectRow(n)}):e.gridApi.selection.selectRow(i))},q=function(i){h(!0),i&&(e.query=i),y(i)},$=function(i,n){i&&(e.src=i),n&&(e.query=n),h(!0),v()};e.$on("selectGridRow:"+e.gridOptionsDef.namespace,function(e,i){b(i)}),e.$on("selectGridRow",function(e,i){b(i)}),e.$on("reloadGrid:"+e.gridOptionsDef.namespace,function(e,i,n){$(i,n)}),e.$on("reloadGrid",function(e,i,n){$(i,n)}),e.$on("refreshGrid:"+e.gridOptionsDef.namespace,function(e,i){q(i)}),e.$on("setLoading",function(e,i){h(i)}),e.$on("refreshGrid",function(e,i){q(i)}),e.$on("adjustHeight",function(e,i){O(i)}),v()}]}}])},{}]},{},[1]);